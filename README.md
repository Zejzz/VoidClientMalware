# Reverse Engineering Attempt on Voidclientv4.exe

## Overview
I attempted to reverse engineer the malware named Voidclientv4.exe or main.exe that had stolen my friend's information. It was distributed by some people on discord from VR Chat and known to steal Discord tokens, Steam accounts, search history, saved logins, and download history. 
All analysis was done in a hyper v windows 11 VM. This is detected by windows defender, but not other antivirus software such as malwarebytes.


## Tools used
- [PyInstxtractor](https://github.com/extremecoders-re/pyinstxtractor)
- [IDA](https://www.hex-rays.com/products/ida/)
- [PEExplorer](https://www.heaventools.com/overview.htm)
- [Procmon](https://docs.microsoft.com/en-us/sysinternals/downloads/procmon/)
- [PyCDC](https://github.com/zrax/pycdc)
- [API Monitor](http://www.rohitab.com/apimonitor)
- [Virustotal (link)](https://www.virustotal.com/gui/file/2b8864a578687d02550afa3716ba7984b9bf99ea0c6d2bcf3e3adc0ec6a1b75d)


## Behaviour of malware
![image](https://github.com/Zejzz/VoidClientMalware/assets/101269994/6a8dbd7f-c91a-4fbd-9d06-0b5164c54e30)

![image](https://github.com/Zejzz/VoidClientMalware/assets/101269994/76cf30cc-9d35-4ebf-ba69-cce76fe10ab1)

![image](https://github.com/Zejzz/VoidClientMalware/assets/101269994/e4a78782-e409-4522-9eee-87631181f3e2)

![image](https://github.com/Zejzz/VoidClientMalware/assets/101269994/f59adfe4-6ab7-49c8-8dfc-fa866c543b05)

![image](https://github.com/Zejzz/VoidClientMalware/assets/101269994/63c86cfe-7d5b-4af8-98f0-400d2ac64417)

![image](https://github.com/Zejzz/VoidClientMalware/assets/101269994/7ad629c4-3c4b-47d3-bc49-cf2212ba392d)

The tool appears to use SSL to communicate with the server, and appears to also send data to a webhook, this can be seen in the partially decompiled python files.
The tool also closes wireshark and other common debuggers, but did not close procmon or winapi monitor


## Analysis
- Opening the file in IDA and looking at strings revealed it was done using PyInstaller.
- Opening the file in PEExplorer confirmed that it was packed with UPX. 
- Virustotal also detected it as being packed with UPX: https://www.virustotal.com/gui/file/2b8864a578687d02550afa3716ba7984b9bf99ea0c6d2bcf3e3adc0ec6a1b75d
- The malware has some form of antidebug that kept closing Wireshark and Fiddler.
- Running Procmon allowed us to see exactly what it does. It modifies the host file and accesses browser user data as well as Discord token and modifies Discord Javascript files. 

Upon opening the malware in IDA and looking at its strings, we discovered that it was built using PyInstaller. This was confirmed by examining the executable file in PEExplorer. We also discovered that it is packed with UPX, as detected by VirusTotal.
We noticed that the malware has an antidebug feature that keeps closing Wireshark and Fiddler. However, using Process Monitor allowed us to observe its behavior, including modification of the host file, accessing browser user data, and modifying Discord JavaScript files.
We were able to unpack the malware and examine the resulting .pyc files. The files revealed main.pyc, discordtoken.pyc, browers.pyc, antidebug.pyc, and injection.pyc. Unfortunately, we were unable to decompile the files properly. We attempted to use pycdc, but it generated code with "unsupported opcode" errors. Additionally, the decompiled Python code contained XOR statements, indicating that some form of obfuscation is being used. We were able to successfully disassemble the main.pyc file using pycdc. We also used API Monitor to monitor calls, although we did not save the logs.

## Unpacking
- We can unpack the .exe into pyc files, they were unpacked using PyInstxtractor
- The unpacked pyc files are in Python 3.10. 
- Decompiling the pyc files was attempted using pycdc but it did not work properly. 
- The decompiled Python code has many XOR statements, suggesting some form of obfuscation is being used.
- The disassembly using pycdc worked, only main.pyc has been disassembled so far. 


## Other notes
- [This post was found, discussing malware that behaves similarly to this one](https://jfrog.com/blog/pypi-malware-creators-are-starting-to-employ-anti-debug-techniques/)


## Future Attempts
- Confirm whether the malware is packed with UPX (may be false from Virustotal).
- Find a better pyc decompiler for Python 3.10.
- Find a way to hook `TerminateProcess` or use a kernel driver to stop network analysis tools from being closed by `TerminateProcess`.
- Find the webhook.
- Create a tool to remedy all changes. 


## Distrubtion of the malware
- The malware was sent via a file sharing website called wetransfer [file1 - no autodownload](https://wetransfer.com/downloads/1427dd238b4a898b87873cb0629c90c420230513181728/65dc36) [file2 - no autodownload](https://wetransfer.com/downloads/fb00c66203532fa65efbe79f4ffcec7b20230513181552/5bd2e4)
- Distrubuted by DaddyHDK#5722 (discord id: 1105509022729240707) ,Lunar月面#5468 (discord id: 1095976484205764679), SYSKEY#3837 (discord id: 1053827600553885707)

![image](https://github.com/Zejzz/VoidClientMalware/assets/101269994/b7e1d484-d8bf-4025-8e77-c6fe024560b1)
![image](https://github.com/Zejzz/VoidClientMalware/assets/101269994/f31b99f0-7296-484b-ba4f-e28c24cf727e)


We believe that the user who sent this malware are not the ones who wrote it due to various reasons. It should be noted that the files appear to be the same, and that wetransfer expires files in 7 days, as such as a copy is updated to the repo.

## Files in this repo:


## Conclusion
We reached a point where further analysis would have required a significant investment of time and skill that we are unable to dedicate at this time. We were not able to fully reverse the malware, and we did not see the point in going past how much was already done.
We recommend resetting the infected machine to a clean state. 
In the future, we suggest confirming the presence of UPX packing, investigating better pyc decompilers for Python 3.10, finding a way to hook terminateprocess or use a kernel driver to prevent network analysis tools from being closed by terminateprocess, and locating the webhook. A remediaal could then be created to undo all the changes made by the malware.
